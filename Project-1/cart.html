<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cart</title>
    <link rel="stylesheet" href="./assets/css/index.css">
</head>

<body>
    <header>
        <nav class="other-nav">
            <h2><a href="./">Shop Easy</a></h2>
            <ul>
                <li><a href="./">Home</a></li>
                <li><a href="./addProduct.html">Add Product</a></li>
                <li><a href="./wishlist.html">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            color="#ffffff" fill="#ff2e2e" stroke="#ffffff" stroke-width="0" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path
                                d="M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z" />
                        </svg>
                    </a></li>
                <li class="cart-list"><a href="./cart.html">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            color="#ffffff" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round">
                            <path d="M8 16L16.7201 15.2733C19.4486 15.046 20.0611 14.45 20.3635 11.7289L21 6" />
                            <path d="M6 6H22" />
                            <circle cx="6" cy="20" r="2" />
                            <circle cx="17" cy="20" r="2" />
                            <path d="M8 20L15 20" />
                            <path
                                d="M2 2H2.966C3.91068 2 4.73414 2.62459 4.96326 3.51493L7.93852 15.0765C8.08887 15.6608 7.9602 16.2797 7.58824 16.7616L6.63213 18" />
                        </svg>
                        <div class="count">

                        </div>
                    </a></li>
            </ul>
        </nav>
    </header>

    <h1 class="cart-h1">Cart</h1>

    <section class="cart-section">
        <div class="cart-container">

        </div>
    </section>
    <section class="total">

    </section>
</body>


<script>
    let cartContainer = document.querySelector(".cart-container");
    let total = document.querySelector(".total");
    let user = JSON.parse(localStorage.getItem("user"));

    function cartUpdate() {
        let cart = JSON.parse(localStorage.getItem(user+"Cart")) || [];
        let count = document.querySelector(".count");
        if (cart.length > 0) {
            count.classList.add("add-count")
            count.textContent = cart.length;
        } else {
            count.classList.remove("add-count");
            count.textContent = "";
            cartContainer.innerHTML = "Your cart is Empty"
        }
    }
    cartUpdate();

    let cart = JSON.parse(localStorage.getItem(user+"Cart"));
    cart.map((item) => {
        
        cartContainer.innerHTML += `<div class="cart-item">
                <div class="img-and-content">
                    <div class="img-container">
                        <img src=${item.thumbnail} alt="macbook air">
                    </div>
                    <div class="content">
                        <h4 class="title">${item.title}</h4>
                        <p class="description">${item.description}</p>
                    </div>
                </div>
                <div class="price-item">
                    <p class="price">₹${item.price}</p>
                </div>
                <div class="quantity">
                    <input onclick="inputChange(event)" data-id=${item.id} type="number" value=${item.quantity} min="1" step="1">
                </div>
                <div class="delete">
                    <svg onclick="deleteItem()" data-id=${item.id} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#E4080A"
                        fill="none" stroke="#E4080A" stroke-width="2" stroke-linecap="round">
                        <path
                            d="M19.5 5.5L18.8803 15.5251C18.7219 18.0864 18.6428 19.3671 18.0008 20.2879C17.6833 20.7431 17.2747 21.1273 16.8007 21.416C15.8421 22 14.559 22 11.9927 22C9.42312 22 8.1383 22 7.17905 21.4149C6.7048 21.1257 6.296 20.7408 5.97868 20.2848C5.33688 19.3626 5.25945 18.0801 5.10461 15.5152L4.5 5.5" />
                        <path
                            d="M3 5.5H21M16.0557 5.5L15.3731 4.09173C14.9196 3.15626 14.6928 2.68852 14.3017 2.39681C14.215 2.3321 14.1231 2.27454 14.027 2.2247C13.5939 2 13.0741 2 12.0345 2C10.9688 2 10.436 2 9.99568 2.23412C9.8981 2.28601 9.80498 2.3459 9.71729 2.41317C9.32164 2.7167 9.10063 3.20155 8.65861 4.17126L8.05292 5.5" />
                        <path d="M9.5 16.5L9.5 10.5" />
                        <path d="M14.5 16.5L14.5 10.5" />
                    </svg>
                </div>
            </div>`;

        item.totalAmount = item.price * item.quantity;
        localStorage.setItem(user+"Cart", JSON.stringify(cart));

        total.innerHTML = `<div class="total-box">
        <h3>Total Price: <span class="price">₹ ${totalCount().toFixed(2)}</span></h3>
        <button class="btn-buy">Order Now</button>
        </div>`;
    })

    function totalCount() {
        let totalPrice = 0.00;
        let cart = JSON.parse(localStorage.getItem(user+"Cart"));
        cart.map(item => {
            totalPrice += item.totalAmount;
        })
        return totalPrice;
    }

    function dynamicChange() {
        let cart = JSON.parse(localStorage.getItem(user+"Cart"));
        console.log("inside dynamicChange()")
        cart.map(item => {
            item.totalAmount = item.price * item.quantity;
            localStorage.setItem(user+"Cart", JSON.stringify(cart));
            total.innerHTML = `<div class="total-box">
                <h3>Total Price: <span class="price">₹ ${totalCount().toFixed(2)}</span></h3>
                <button class="btn-buy">Order Now</button>
                </div>`;
        })
    }

    function inputChange(e) {
        let value = e.target.value;
        let cart = JSON.parse(localStorage.getItem(user+"Cart"));
        cart.map((item) => {
            if (value > 0 && e.target.dataset.id == item.id) {
                item.quantity = Number(value);
                localStorage.setItem(user+"Cart", JSON.stringify(cart));
                dynamicChange();
            }
        })
    }

    // delete svg
    function deleteItem() {
        let cart = JSON.parse(localStorage.getItem(user+"Cart"));
        cart.map((item, index) => {
            let itemToDelete = cart[index];
            let updatedArray = cart.filter(itm => itm != itemToDelete);
            localStorage.setItem(user+"Cart", JSON.stringify(updatedArray));
            cartUpdate();
            reload();
        })
    }


    function reload() {
        cartContainer.innerHTML = '';
        total.innerHTML = "";
        let cart = JSON.parse(localStorage.getItem(user+"Cart"));
        cart.map((item) => {
            cartContainer.innerHTML += `<div class="cart-item">
                <div class="img-and-content">
                    <div class="img-container">
                        <img src=${item.thumbnail} alt="macbook air">
                    </div>
                    <div class="content">
                        <h4 class="title">${item.title}</h4>
                        <p class="description">${item.description}</p>
                    </div>
                </div>
                <div class="price-item">
                    <p class="price">₹${item.price}</p>
                </div>
                <div class="quantity">
                    <input onclick="inputChange(event)" data-id=${item.id} type="number" value=${item.quantity} min="1" step="1">
                </div>
                <div class="delete">
                    <svg onclick="deleteItem()" data-id=${item.id} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#E4080A"
                        fill="none" stroke="#E4080A" stroke-width="2" stroke-linecap="round">
                        <path
                            d="M19.5 5.5L18.8803 15.5251C18.7219 18.0864 18.6428 19.3671 18.0008 20.2879C17.6833 20.7431 17.2747 21.1273 16.8007 21.416C15.8421 22 14.559 22 11.9927 22C9.42312 22 8.1383 22 7.17905 21.4149C6.7048 21.1257 6.296 20.7408 5.97868 20.2848C5.33688 19.3626 5.25945 18.0801 5.10461 15.5152L4.5 5.5" />
                        <path
                            d="M3 5.5H21M16.0557 5.5L15.3731 4.09173C14.9196 3.15626 14.6928 2.68852 14.3017 2.39681C14.215 2.3321 14.1231 2.27454 14.027 2.2247C13.5939 2 13.0741 2 12.0345 2C10.9688 2 10.436 2 9.99568 2.23412C9.8981 2.28601 9.80498 2.3459 9.71729 2.41317C9.32164 2.7167 9.10063 3.20155 8.65861 4.17126L8.05292 5.5" />
                        <path d="M9.5 16.5L9.5 10.5" />
                        <path d="M14.5 16.5L14.5 10.5" />
                    </svg>
                </div>
            </div>`;

            item.totalAmount = item.price * item.quantity;
            localStorage.setItem(user+"Cart", JSON.stringify(cart));

            if (totalCount() !== 0) {
                dynamicChange();
            }
            cartUpdate();
        })
    }


</script>

</html>