<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17-12 Project-1 JavaScript Ecommerce Website</title>
    <link href="./assets/css/index.css" rel="stylesheet">
</head>

<body>
    <header>
        <nav class="home-nav">
            <h2><a href="./">Shop Easy</a></h2>
            <ul>
                <li><a href="./">Home</a></li>
                <li><a href="./addProduct.html">Add Product</a></li>
                <li><a href="./wishlist.html">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            color="#ffffff" fill="#ff2e2e" stroke="#ffffff" stroke-width="0" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path
                                d="M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z" />
                        </svg>
                    </a></li>
                <li class="cart-list"><a href="./cart.html">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                            color="#ffffff" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round">
                            <path d="M8 16L16.7201 15.2733C19.4486 15.046 20.0611 14.45 20.3635 11.7289L21 6" />
                            <path d="M6 6H22" />
                            <circle cx="6" cy="20" r="2" />
                            <circle cx="17" cy="20" r="2" />
                            <path d="M8 20L15 20" />
                            <path
                                d="M2 2H2.966C3.91068 2 4.73414 2.62459 4.96326 3.51493L7.93852 15.0765C8.08887 15.6608 7.9602 16.2797 7.58824 16.7616L6.63213 18" />
                        </svg>
                        <div class="count">

                        </div>
                    </a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>Discover New Stores</h1>
            <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Voluptas voluptates facere modi libero autem
                eveniet voluptatem tempora, hic nam necessitatibus fugiat facilis, distinctio eum. Libero magnam
                molestias rem mollitia officiis.</p>
            <button class="btn-buy">Shop Now</button>
        </div>
    </section>

    <section class="feature-section">
        <div class="feature-container">
            <div class="feature">
                <div class="png">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" color="#000000"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <path
                            d="M3.3457 16.1976L16.1747 3.36866M18.6316 11.0556L16.4321 13.2551M14.5549 15.1099L13.5762 16.0886" />
                        <path
                            d="M3.17467 16.1411C1.60844 14.5749 1.60844 12.0355 3.17467 10.4693L10.4693 3.17467C12.0355 1.60844 14.5749 1.60844 16.1411 3.17467L20.8253 7.85891C22.3916 9.42514 22.3916 11.9645 20.8253 13.5307L13.5307 20.8253C11.9645 22.3916 9.42514 22.3916 7.85891 20.8253L3.17467 16.1411Z" />
                        <path d="M4 22H20" />
                    </svg>
                </div>
                <h5>Secure Payment</h5>
                <p>Lorem ipsum dolor</p>
            </div>
            <div class="feature">
                <div class="png">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" color="#000000"
                        fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M19.5 17.5C19.5 18.8807 18.3807 20 17 20C15.6193 20 14.5 18.8807 14.5 17.5C14.5 16.1193 15.6193 15 17 15C18.3807 15 19.5 16.1193 19.5 17.5Z" />
                        <path
                            d="M9.5 17.5C9.5 18.8807 8.38071 20 7 20C5.61929 20 4.5 18.8807 4.5 17.5C4.5 16.1193 5.61929 15 7 15C8.38071 15 9.5 16.1193 9.5 17.5Z" />
                        <path
                            d="M14.5 17.5H9.5M15 15.5V7C15 5.58579 15 4.87868 14.5607 4.43934C14.1213 4 13.4142 4 12 4H5C3.58579 4 2.87868 4 2.43934 4.43934C2 4.87868 2 5.58579 2 7V15C2 15.9346 2 16.4019 2.20096 16.75C2.33261 16.978 2.52197 17.1674 2.75 17.299C3.09808 17.5 3.56538 17.5 4.5 17.5M15.5 6.5H17.3014C18.1311 6.5 18.5459 6.5 18.8898 6.6947C19.2336 6.8894 19.4471 7.2451 19.8739 7.95651L21.5725 10.7875C21.7849 11.1415 21.8911 11.3186 21.9456 11.5151C22 11.7116 22 11.918 22 12.331V15C22 15.9346 22 16.4019 21.799 16.75C21.6674 16.978 21.478 17.1674 21.25 17.299C20.9019 17.5 20.4346 17.5 19.5 17.5" />
                    </svg>
                </div>
                <h5>Free Shipping</h5>
                <p>For $50 order</p>
            </div>
            <div class="feature">
                <div class="png">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" color="#000000"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M12 22C11.1818 22 10.4002 21.6698 8.83693 21.0095C4.94564 19.3657 3 18.5438 3 17.1613C3 16.7742 3 10.0645 3 7M12 22C12.8182 22 13.5998 21.6698 15.1631 21.0095C19.0544 19.3657 21 18.5438 21 17.1613V7M12 22L12 11.3548" />
                        <path
                            d="M8.32592 9.69138L5.40472 8.27785C3.80157 7.5021 3 7.11423 3 6.5C3 5.88577 3.80157 5.4979 5.40472 4.72215L8.32592 3.30862C10.1288 2.43621 11.0303 2 12 2C12.9697 2 13.8712 2.4362 15.6741 3.30862L18.5953 4.72215C20.1984 5.4979 21 5.88577 21 6.5C21 7.11423 20.1984 7.5021 18.5953 8.27785L15.6741 9.69138C13.8712 10.5638 12.9697 11 12 11C11.0303 11 10.1288 10.5638 8.32592 9.69138Z" />
                        <path d="M6 12L8 13" />
                        <path d="M17 4L7 9" />
                    </svg>
                </div>
                <h5>Delivered with Care</h5>
                <p>Lorem ipsum dolor</p>
            </div>
            <div class="feature">
                <div class="png">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" color="#000000"
                        fill="none" stroke="#141B34" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M19.4173 15.7133C23.368 10.7038 22.3007 5.73508 19.4626 3.99415C16.7809 2.34923 14.4404 3.01211 13.0344 4.06801L11.9998 4.84158M19.4173 15.7133C18.469 16.9156 17.2317 18.1204 15.6605 19.2834C14.1143 20.4278 13.3412 21 12 21C10.6588 21 9.88572 20.4278 8.33953 19.2834C0.22172 13.2749 1.01807 6.15293 4.53744 3.99415C7.21909 2.34923 9.55962 3.01211 10.9656 4.06801L11.9998 4.84158M19.4173 15.7133L13.8921 9.44479C13.6659 9.1882 13.2873 9.13296 12.9972 9.31424L10.8111 10.6806C10.0418 11.1614 9.04334 11.0532 8.3949 10.4187C7.53837 9.58062 7.62479 8.17769 8.5777 7.45106L11.9998 4.84158" />
                    </svg>
                </div>
                <h5>Excellent Services</h5>
                <p>sit amet consectetur</p>
            </div>
        </div>
    </section>

    <section>
        <div class="cards">

        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let cards = document.querySelector(".cards");
        cards.innerHTML = "";
        localStorage.removeItem("productsarray");
        let productsArray = JSON.parse(localStorage.getItem("productsarray")) || [];
        let user = JSON.parse(localStorage.getItem("user"));
        let userWishlist = JSON.parse(localStorage.getItem(user + "Wishlist")) || [];

        $.ajax({
            url: "https://dummyjson.com/product",
            method: "GET",
            async: false,
            success: function (res) {
                res.products.forEach((product, index) => {
                    if (userWishlist.length === 0) {
                        product.wishlist = false;
                        productsArray.push(product);
                        localStorage.setItem("productsarray", JSON.stringify(productsArray));
                    } else {
                        userWishlist.map(uw => {
                            // console.log(productsArray.includes(product))
                            // if (!productsArray.includes(product)) {
                                if ((uw.id) == product.id) {
                                    // console.log(index, uw.id, product.id);
                                    product.wishlist = uw.wishlist || false;
                                    if(!productsArray.includes(product)){
                                        productsArray.push(product);
                                    }
                                } else {
                                    // console.log("else", index, uw.id, product.id)
                                    product.wishlist = product.wishlist || false;
                                    if(product.wishlist == false && !productsArray.includes(product)){
                                        productsArray.push(product);
                                    }
                                }
                            // }
                            localStorage.setItem("productsarray", JSON.stringify(productsArray));
                        })
                    }
                })



















                // for (let i = 0; i < res.products.length; i++) {
                //     console.log(product.length);
                //     if (product.length <= 29) {
                //         console.log(userWishlist.length)
                //         if (i < userWishlist.length) {
                //             if(res.products[i].id == userWishlist[i].id){
                //                 res.products[i].wishlist = userWishlist[i].wishlist;
                //                 product.push(res.products[i]);
                //             } else{
                //                 res.products[i].wishlist = false;
                //                 product.push(res.products[i]);
                //             }
                //         }
                //         else {
                //             res.products[i].wishlist = false;
                //             product.push(res.products[i]);
                //         }
                //         localStorage.setItem("productsarray", JSON.stringify(product));
                //     } else {
                //         res.products[i].wishlist = false;
                //         product.push(res.products[i]);
                //         localStorage.setItem("productsarray", JSON.stringify(product));
                //     }
                // }
            }
        })


        function cartUpdate() {
            let cart = JSON.parse(localStorage.getItem(user + "Cart")) || [];
            let count = document.querySelector(".count");
            if (cart.length > 0) {
                count.classList.add("add-count")
                count.textContent = cart.length;
            }
        }
        cartUpdate();




        let userCart = JSON.parse(localStorage.getItem(user + "Wishlist")) || [];
        if (userCart.length > 0) {
            productsArray.forEach(card => {
                userCart.forEach(uc => {
                    if (uc.id == card.id) {
                        if (uc.wishlist === true) {
                            card.wishlist = true;
                        } else {
                            card.wishlist = false;
                        }
                    }
                })
            })
        }
        let products = JSON.parse(localStorage.getItem("productsarray"));
        products.map((card, index) => {
            cards.innerHTML +=
                `<div class="card">
                <div class="img-container">
                    <img src=${card.thumbnail} alt="thumbnail">
                    <svg data-id=${card?.id} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#ffffff"
                        fill=${card?.wishlist ? "#ff2e2e" : "none"} stroke="#000000" stroke-width=${card?.wishlist ? "0" : "1.5"} stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z" />
                    </svg>
                </div>
                <h3 class="title" title="${card.title}">${card.title}</h3>
                <p class="description" title="${card.description}">${card.description}</p>
                <p class="price">$${card.price}</p>
                <div class="button">
                    <button data-id=${card.id} class="btn-cart">Add to Cart</button>
                    <button data-id=${card.id} class="btn-buy">Buy Now</button>
                </div>
            </div>`
        })

        let cardWishlist = document.querySelectorAll(".card>.img-container>svg");
        cardWishlist.forEach((cw, i) => {
            cw.addEventListener("click", function () {
                if (cw.getAttribute("fill") == "none") {
                    cw.setAttribute("fill", "#ff2e2e");
                    cw.setAttribute("stroke-width", "0");
                    let userCart = JSON.parse(localStorage.getItem(user + "Wishlist")) || [];
                    userCart.push(products[i]);
                    let dataId = Number(this.dataset.id);
                    userCart.forEach(uc => {
                        if ((uc.id == products[i].id) && (uc.id == dataId)) {
                            uc.wishlist = true;
                            products[i].wishlist = true;
                        }
                    })
                    localStorage.setItem(user + "Wishlist", JSON.stringify(userCart));
                } else {
                    cw.setAttribute("fill", "none");
                    cw.setAttribute("stroke-width", "1.5");
                    let userCart = JSON.parse(localStorage.getItem(user + "Wishlist"));
                    let dataId = Number(this.dataset.id);
                    let filteredUserCart = userCart.filter(uc => {
                        if ((uc.id == products[i].id) && (uc.id == this.dataset.id)) {
                            uc.wishlist = false;
                            products[i].wishlist = false;
                        }
                        return uc.id !== dataId;
                    })
                    localStorage.setItem(user + "Wishlist", JSON.stringify(filteredUserCart));
                }
                localStorage.setItem("productsarray", JSON.stringify(products));
            })
        })

        products.map((product) => {
            let cartButton = document.querySelectorAll(".btn-cart");

            for (let i = 0; i < cartButton.length; i++) {
                cartButton[i].addEventListener("click", function () {
                    if (this.dataset.id == product.id) {
                        let cart = JSON.parse(localStorage.getItem(user + "Cart")) || [];
                        product.quantity = 1;
                        cart.push(product);
                        localStorage.setItem(user + "Cart", JSON.stringify(cart));
                        cartUpdate();
                    }
                })
            }
        })



    </script>
</body>

</html>